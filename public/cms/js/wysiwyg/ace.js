CMS.ui.add("ace",function(){function e(e){switch(e){case"application/json":return"json";case"text/plain":return"text";default:return 0===e.indexOf("text/x-")?e.substring(7):0===e.indexOf("text/")?e.substring(5):"text"}}var t={};t.switchOn_handler=function(t,n){var i,a=getSlug(t)+"Div",s=$("#"+t).hide();n=$.extend({height:300},s.data(),n),i=n.mode||"php",_.has(n,"mime")&&(i=e(n.mime));var c=$('<div id="'+a+'" />').insertAfter(s).css({height:n.height,fontSize:14}),r=ace.edit(a);return r.$blockScrolling=1/0,r.setValue(s.val()),r.clearSelection(),r.getSession().setMode("ace/mode/"+i),r.getSession().setTabSize(4),r.getSession().setUseSoftTabs(!1),r.getSession().setUseWrapMode(!0),r.getSession().on("change",function(){s.val(r.getSession().getValue())}),r.setTheme("ace/theme/"+ACE_THEME),_.propertyOf(n)("readonly")?r.setReadOnly(!0):r.commands.addCommand({bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(e){$('button[name="continue"]').click()}}),r.commands.addCommand({name:"Full-screen",bindKey:{win:"Ctrl-Shift-F",mac:"Command-Shift-F"},exec:function(e){FullScreen.toggle(c[0])}}),r},t.switchOff_handler=function(e,t){$("#"+getSlug(t)+"Div").remove()},t.exec_handler=function(e,t,n,i){var n=getSlug(n);switch(t){case"insert":e.insert(i);break;case"changeHeight":$("#"+n+"Div").css({height:i}),e.resize()}return!0},CMS.filters.add("ace",t.switchOn_handler,t.switchOff_handler,t.exec_handler)});